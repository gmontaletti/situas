# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

R package for accessing the Situas API (https://situas.istat.it/web/#/apiDetail) - a set of APIs built by ISTAT (Italian National Institute for Statistics) to retrieve territorial codes and classifications.

**Core Functionality:**
- Retrieve territorial classification tables from Situas API
- Reclassify old territorial codes to new ones
- Batch detection and recoding of territorial codes in datasets

**Author:** Giampaolo Montaletti (giampaolo.montaletti@gmail.com, github.com/gmontaletti)

## Development Stack

- **Testing:** `testthat` for unit tests
- **Development:** `devtools` for package development workflow
- **Documentation:** `roxygen2` for function documentation
- **Environment:** `renv` for dependency management
- **Data Wrangling:** `data.table` (preferred over dplyr/tidyverse)
- **Performance:** Use vectorized code, avoid for loops
- **Offline Support:** Implement caching for API responses

## Key Commands

```r
# Setup environment
renv::restore()

# Load package for development
devtools::load_all()

# Run tests
devtools::test()

# Run single test file
testthat::test_file("tests/testthat/test-<name>.R")

# Check package
devtools::check()

# Build documentation
devtools::document()

# Install package locally
devtools::install()
```

## Development Guidelines

1. **Use agents for all development tasks** - planning, coding, testing, documentation
2. **Never modify the original `moneca()` function** if it exists
3. Follow CRAN standards for package structure
4. Write tests using testthat for all new functions
5. Use data.table syntax for data manipulation (not dplyr)
6. Implement caching mechanism for offline API access
7. Use vectorized operations for performance

## Package Structure (Standard R Package)

- `R/` - Function definitions
- `tests/testthat/` - Unit tests
- `man/` - Generated documentation (via roxygen2)
- `DESCRIPTION` - Package metadata
- `NAMESPACE` - Package namespace (generated by roxygen2)
- `renv/` - Environment management files

## Important Notes

- The `.claude` directory should not be moved during cleanup
- When bumping version, update citation in README.md
